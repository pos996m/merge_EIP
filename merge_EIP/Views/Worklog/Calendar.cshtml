
@{
    ViewBag.Title = "行事曆";
}

<link href="~/Scripts/FullCalendar/main.min.css" rel="stylesheet" />
<script src="~/Scripts/FullCalendar/main.min.js"></script>
<style>
    html,body{
        @*height:auto;*@
    }
    .fc-view-harness {
        box-shadow: 0 0.125rem 0.25rem rgb(0 0 0 / 8%) !important;
    }
    .text-noLine {
        text-decoration: line-through;
    }

    .text-overhide {
        text-overflow: ellipsis;
    }

    .fc-daygrid-event-harness {
        cursor: pointer;
    }


@* 這邊是使用hover *@
    .popper,
    .tooltip {
        position: absolute;
        z-index: 9999;
        background: #FFC107;
        color: black;
        width: 150px;
        border-radius: 3px;
        box-shadow: 0 0 2px rgba(0,0,0,0.5);
        padding: 10px;
        text-align: center;
    }

    .style5 .tooltip {
        background: #1E252B;
        color: #FFFFFF;
        max-width: 200px;
        width: auto;
        font-size: .8rem;
        padding: .5em 1em;
    }

    .popper .popper__arrow,
    .tooltip .tooltip-arrow {
        width: 0;
        height: 0;
        border-style: solid;
        position: absolute;
        margin: 5px;
    }

    .tooltip .tooltip-arrow,
    .popper .popper__arrow {
        border-color: #FFC107;
    }

    .style5 .tooltip .tooltip-arrow {
        border-color: #1E252B;
    }

    .popper[x-placement^="top"],
    .tooltip[x-placement^="top"] {
        margin-bottom: 5px;
    }

        .popper[x-placement^="top"] .popper__arrow,
        .tooltip[x-placement^="top"] .tooltip-arrow {
            border-width: 5px 5px 0 5px;
            border-left-color: transparent;
            border-right-color: transparent;
            border-bottom-color: transparent;
            bottom: -5px;
            left: calc(50% - 5px);
            margin-top: 0;
            margin-bottom: 0;
        }

    .popper[x-placement^="bottom"],
    .tooltip[x-placement^="bottom"] {
        margin-top: 5px;
    }

        .tooltip[x-placement^="bottom"] .tooltip-arrow,
        .popper[x-placement^="bottom"] .popper__arrow {
            border-width: 0 5px 5px 5px;
            border-left-color: transparent;
            border-right-color: transparent;
            border-top-color: transparent;
            top: -5px;
            left: calc(50% - 5px);
            margin-top: 0;
            margin-bottom: 0;
        }

    .tooltip[x-placement^="right"],
    .popper[x-placement^="right"] {
        margin-left: 5px;
    }

        .popper[x-placement^="right"] .popper__arrow,
        .tooltip[x-placement^="right"] .tooltip-arrow {
            border-width: 5px 5px 5px 0;
            border-left-color: transparent;
            border-top-color: transparent;
            border-bottom-color: transparent;
            left: -5px;
            top: calc(50% - 5px);
            margin-left: 0;
            margin-right: 0;
        }

    .popper[x-placement^="left"],
    .tooltip[x-placement^="left"] {
        margin-right: 5px;
    }

        .popper[x-placement^="left"] .popper__arrow,
        .tooltip[x-placement^="left"] .tooltip-arrow {
            border-width: 5px 0 5px 5px;
            border-top-color: transparent;
            border-right-color: transparent;
            border-bottom-color: transparent;
            right: -5px;
            top: calc(50% - 5px);
            margin-left: 0;
            margin-right: 0;
        }
</style>
<div class="container p-33">
    <br />
    <h2>Calendar</h2>
    <hr>
    <span id="EID" style="display:none">@Session["ID"]</span>
    <span id="DepID" style="display:none">@Session["DepID"]</span>

    <div id="calendar" class=""></div>
    <br />
    <br />
    <br />
    <br />
</div>

<script>
    $(document).ready(() => {
        console.log("ready");

        const EID = $("#EID").text();
        const DepID = $("#DepID").text();

        const xhttp = new XMLHttpRequest();
        xhttp.open("GET", "/api/WorklogCalAPI" + encodeURI(`?EID=${EID}&DepID=${DepID}`), true);
        xhttp.send();
        // 要取得JSON要等他load完才拿得到
        xhttp.onload = () => {
            // 解析API回傳JSON
            dataShow = JSON.parse(xhttp.responseText);
            console.log(dataShow);
            calshowrender(dataShow);
            $(".fc-event-title").addClass("text-overhide");
        }
    });


    let calList = [
        {
            title: "去全聯",
            start: "2021-09-10T15:16",
            ppp: "work",
        },
        {
            title: "小美請假",
            start: "2021-09-10",
            color: "green",
            ppp: "itmp",
        },
    ];

    function calshowrender(dataList) {
        var calendarEl = document.getElementById("calendar");

        var calendar = new FullCalendar.Calendar(calendarEl, {
            headerToolbar: {
                left: "title",
                center: "",
                right: "prev,next today",
            },
            businessHours: true, // display business hours
            selectable: true,
            titleFormat: {
                year: "numeric",
                month: "2-digit",
            },
            dateClick: function (info) {
                // 點擊格子
            },
            eventClick: function (info) {

                // 如果藏的類別是 留言板 轉跳到 該留言，如果是 待辦事項 就轉跳 該待辦
                if (info.event._def.extendedProps.state == "留言板") {
                    document.location.href = `/Message/MsgIndex/${info.event._def.extendedProps.num}`
                } else if (info.event._def.extendedProps.state == "待辦事項") {
                    document.location.href = `/Worklog/Todolist/${info.event._def.extendedProps.num}`
                }
            },
            // 使用 bootstrap 做為樣式
            themeSystem: "bootstrap",

            // 表頭


            // 放入data顯示
            events: dataList,
            // 改點點樣式
            eventDisplay: "list-item",
        });

        calendar.render();
    }
</script>